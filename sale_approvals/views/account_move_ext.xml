<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <record id="account_view_move_form_ext" model="ir.ui.view">
            <field name="name">account.view.move.form.ext</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/header" position="replace">
                    <header>
                        <!-- Post -->
                        <button name="action_post" string="Post" class="oe_highlight" type="object" groups="account.group_account_invoice"
                                attrs="{'invisible': ['|', '|', ('state', '!=', 'draft'), ('auto_post', '=', True),
                                ('move_type', '!=', 'entry')]}"/>
<!--                        <button name="action_post" string="Confirm" class="oe_highlight" type="object" groups="account.group_account_invoice"-->
<!--                                attrs="{'invisible': ['|', '|', ('state', '!=', 'draft'), ('auto_post', '=', True),-->
<!--                                ('move_type', '=', 'entry')]}"/>-->
                        <button name="send_to_fm" attrs="{'invisible': [('state', 'not in', ['draft', 'sent'])]}"
                                string="Send for Approval" type="object" class="oe_highlight"/>
                        <button name="validate_fm" attrs="{'invisible': [('state', '!=', 'fm')]}"
                                string="Approve" type="object" class="oe_highlight" groups="account.group_account_manager"
                                context="{'not_unlink_on_discard': True}"/>
                        <button name="button_reject_fm" attrs="{'invisible': [('state', '!=', 'fm')]}"
                                string="Reject" type="object" groups="account.group_account_manager"
                                context="{'not_unlink_on_discard': True}"/>
                        <!-- Send (only invoices) -->
                        <button name="action_invoice_sent" type="object" string="Send &amp; Print"
                                attrs="{'invisible':['|', '|', ('state', '!=', 'posted'), ('is_move_sent', '=', True),
                                ('move_type', 'not in', ('out_invoice', 'out_refund'))]}" class="oe_highlight"/>
                        <button name="action_invoice_sent" type="object" string="Send &amp; Print"
                                attrs="{'invisible':['|', '|', ('state', '!=', 'posted'), ('is_move_sent', '=', False),
                                ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}"/>
                        <!-- Register Payment (only invoices / receipts) -->
                        <button name="action_register_payment" id="account_invoice_payment_btn" type="object"
                                class="oe_highlight" attrs="{'invisible': ['|', '|', ('state', '!=', 'posted'),
                                ('payment_state', 'not in', ('not_paid', 'partial')), ('move_type', 'not in',
                                ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"
                                context="{'dont_redirect_to_payments': True}" string="Register Payment" groups="account.group_account_invoice"/>
                        <!-- Preview (only customer invoices) -->
                        <button name="preview_invoice" type="object" string="Preview"
                                attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}"/>
                        <!-- Reverse -->
                        <button name="215" string="Reverse Entry" type="action" groups="account.group_account_invoice"
                                attrs="{'invisible': ['|', ('move_type', '!=', 'entry'), '|', ('state', '!=', 'posted'),
                                ('payment_state', '=', 'reversed')]}"/>
                        <button name="action_reverse" string="Add Credit Note" type="object"
                                groups="account.group_account_invoice" attrs="{'invisible': ['|',
                                ('move_type', 'not in', ('out_invoice', 'in_invoice')), ('state', '!=', 'posted')]}"/>
                        <!-- Cancel -->
                        <button name="button_cancel" string="Cancel Entry" type="object"
                                groups="account.group_account_invoice" attrs="{'invisible' : ['|', ('id', '=', False),
                                ('state', '!=', 'draft')]}"/>
                        <button name="button_draft" string="Reset to Draft" type="object"
                                groups="account.group_account_invoice" attrs="{'invisible' : [('show_reset_to_draft_button', '=', False)]}"/>
                        <button name="set_draft" string="Reset to Draft" type="object"
                                groups="account.group_account_manager" attrs="{'invisible' : [('state', '!=', 'reject')]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,fm,posted"/>
                    </header>
                </xpath>
            </field>
         </record>

     </data>
 </odoo>
