<odoo>
    <record id="view_order_form" model="ir.ui.view">
        <field name="name">sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_confirm'][2]" position="attributes">
                <attribute name="invisible">[['state', 'not in', ['sales_manager','general_manager','account_manager']]]</attribute>
<!--                <button name="action_confirm" states="draft" string="Confirm Sale" class="o_sale_confirm" type="object" invisible="1"/>-->
            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('state', 'not in', ['draft', 'sent', 'sale', 'approved']), ('id', '=', False), ('is_record_owner', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='action_confirm'][1]" position="replace">
                <button name="action_confirm" id="action_confirm" data-hotkey="v" string="Confirm" class="btn-primary" type="object" attrs="{'invisible': ['|', ('state', 'not in', ['approved']), ('is_record_owner', '=', False)]}"/>
             </xpath>
            <xpath expr="//field[@name='state']" position="replace">
                   <field name="state" widget="statusbar" statusbar_visible="draft,sent,first_approval,second_approval,sale"/>
            </xpath>
             <xpath expr="//button[@name='action_quotation_send']" position="after">
                   <button name="action_sales_manager_approval" states="draft,sent" type="object" string="Send for Approval" context="{'turn_view_readonly':True}"/>
                   <button name="action_general_manager_approval" states="sales_manager" type="object" class="btn-primary" string="Approve" confirm="Are you sure you want to do this?" groups="ng_approvals.group_sale_manager" />
                   <button name="action_account_manager_approval" states="general_manager" type="object" class="btn-primary" string="Approve" confirm="Are you sure you want to do this?" groups="ng_approvals.group_sale_general_manager" />
                   <button name="action_approved" states="account_manager" type="object" string="Approve" class="btn-primary" confirm="Are you sure you want to do this?" groups="account.group_account_manager" />
                   <button name="%(action_sales_rejection)d" states="sales_manager,general_manager,account_manager" type="action" string="Reject" groups="ng_approvals.group_sale_manager,ng_approvals.group_sale_general_manager,account.group_account_manager" />
            </xpath>
            <xpath expr="//field[@name='partner_shipping_id']" position="after">
                <field name="is_record_owner" invisible="1"/>
                <field name="is_my_approval" invisible="1"/>
                <field name="geo_zones"/>
                <field name="rejected_by" attrs="{'invisible': [('reject_reason', '=', False)]}"/>
                <field name="reject_reason" attrs="{'invisible': [('reject_reason', '=', False)]}"/>
            </xpath>
            <xpath expr="//notebook/page/field[@name='order_line']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel','sales_manager','general_manager','account_manager','rejected'))]}</attribute>
            </xpath>
        </field>
    </record>

<!--    <record id="view_order_tree" model="ir.ui.view">-->
<!--        <field name="name">sale.order.tree</field>-->
<!--        <field name="model">sale.order</field>-->
<!--        <field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>-->
<!--        <field name="arch" type="xml">-->
<!--            <xpath expr="//field[@name='partner_id']" position="after">-->
<!--                <field name="is_my_approval" invisible="1"/>-->
<!--            </xpath>-->
<!--        </field>-->
<!--    </record>-->

<!--    <record id="action_sale_approval" model="ir.actions.act_window">-->
<!--        <field name="name">Sales Approval</field>-->
<!--        <field name="type">ir.actions.act_window</field>-->
<!--        <field name="res_model">sale.order</field>-->
<!--&lt;!&ndash;        <field name="name">sale.order.list.select</field>&ndash;&gt;-->
<!--        <field name="arch" type="xml">-->

<!--        </field>-->
<!--    </record>-->

    <record id="view_sales_order_filter_inherit" model="ir.ui.view">
        <field name="name">sale.order.search.inherit.quotation</field>
        <field name="model">sale.order</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
        <field name="arch" type="xml">
            <xpath expr="//group/filter[@name='salesperson']" position="after">
                <filter string="Zone" name="zone" domain="[]" context="{'group_by': 'geo_zones'}"/>
            </xpath>
        </field>
    </record>

    <record id="sale_order_view_search_inherit_approval_filter" model="ir.ui.view">
        <field name="name">sale.order.search.inherit.approval</field>
        <field name="model">sale.order</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="sale.view_sales_order_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='my_sale_orders_filter']" position="replace">
<!--                <field name="campaign_id"/>-->
<!--                <separator/>-->
<!--                <field name="is_my_approval"/>-->
                <filter string="My Approvals" name="my_approval" domain="[('is_my_approval', '=', True)]"/>
                <separator/>
<!--                <filter string="Zone" name="draft" domain="[('geo_zone','in',('draft', 'sent'))]"/>-->
            </xpath>
            <xpath expr="//group/filter[@name='salesperson']" position="after">
                <filter string="Zone" name="zone" domain="[]" context="{'group_by': 'geo_zones'}"/>
            </xpath>
        </field>
    </record>

    <record id="action_sale_approval" model="ir.actions.act_window">
        <field name="name">Sales Approval</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_id" ref="sale.view_quotation_tree_with_onboarding"/>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="sale_order_view_search_inherit_approval_filter"/>
        <field name="context">{'search_default_my_approval': 1}</field>
        <field name="domain">[('state', 'in', ('sales_manager', 'general_manager', 'account_manager'))]</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Create a Quotation, the first step of a new sale.
            </p><p>
                Once the quotation is confirmed, it becomes a sales order.
                You'll be able to invoice it and collect payments.
                From the <i>Sales Orders</i> menu, you can track delivery
                orders or services.
            </p>
        </field>
    </record>

    <menuitem action="action_sale_approval"
            id="menu_sale_approval" parent="sale.sale_order_menu"
            sequence="11" groups="group_sale_manager,group_sale_general_manager,account.group_account_manager"/>
</odoo>